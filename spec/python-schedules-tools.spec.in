%global srcname schedules-tools

%global log_dir /var/log/%{name}
%global log_files debug.log


Name:           python-%{srcname}
Version:        %{version}
Release:        %{release_number}.%{checkout}%{?dist}
Epoch:          1
Summary:        Schedule tools to handle various formats (TaskJuggler, MS Project)

License:        BSD
Group:          Applications/Engineering
Url:            https://github.com/RedHat-Eng-PGM/schedules-tools
Source0:        %{srcname}-%{version}.%{release_number}.tar.gz
BuildArch:      noarch

%description
Schedule tools to handle various formats (TaskJuggler, MS Project)

%if 0%{?rhel} <= 7 && 0%{?fedora} == 0

BuildRequires: python-setuptools
BuildRequires: python-devel

%else

BuildRequires: python2-setuptools
BuildRequires: python2-devel

BuildRequires: python3-setuptools
BuildRequires: python3-devel

%endif



%package -n python2-%{srcname}
Summary:        %{summary}

Requires: python2-icalendar

%if 0%{?rhel} <= 7 && 0%{?fedora} == 0
Requires: python-lxml
%else
Requires: python2-lxml
%endif

%{?python_provide:%python_provide python2-%{srcname}}



%package -n python3-%{srcname}
Summary:        %{summary}

Requires: python3-icalendar
Requires: python3-lxml

%{?python_provide:%python_provide python3-%{srcname}}



%description -n python2-%{srcname}
Schedule tools to handle various formats (TaskJuggler, MS Project)

%description -n python3-%{srcname}
Schedule tools to handle various formats (TaskJuggler, MS Project)



%prep
%autosetup -n %{srcname}-%{version}.%{release_number}



%build
%if 0%{?fedora} <= 31
%py2_build
%endif

%py3_build



%install
%if 0%{?fedora} <= 31
%py2_install
%endif

%py3_install

# create log dir
mkdir -m 755 -p %{buildroot}%{log_dir}
for log_file in %log_files ; do
    touch %{buildroot}%{log_dir}/$log_file
done



%files -n python2-%{srcname}
%defattr(644,root,root,755)
%{python2_sitelib}/*

%attr(755,root,root) %{_bindir}/schedule-*

# setup permissions so that logrotate works correctly
%defattr(664,root,apache,755)
%dir %log_dir
%ghost %config %log_dir/*



%files -n python3-%{srcname}
%defattr(644,root,root,755)
%{python3_sitelib}/*

%attr(755,root,root) %{_bindir}/schedule-*

# setup permissions so that logrotate works correctly
%defattr(664,root,apache,755)
%dir %log_dir
%ghost %config %log_dir/*



%changelog
